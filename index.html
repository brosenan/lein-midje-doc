<html><head><meta content="chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport" /><title>midje-doc</title><style>body {
  padding:50px;
  font:14px/1.5 Helvetica, Arial, sans-serif;
  color:#777;
  font-weight:300;
}

h1, h2, h3, h4, h5, h6 {
  color:#222;
  margin:0 0 20px;
}

p, ul, ol, table, pre, dl {
  margin:0 0 20px;
}

h1, h2, h3 {
  line-height:1.1;
}

h1 {
  font-size:28px;
}

h2 {
  color:#393939;
}

h4, h5, h6 {
  color:#494949;
  margin:0;
}

header h4{
  margin: 10 0 0 0px;
}

a {
  color:#39c;
  font-weight:400;
  text-decoration:none;
}

a small {
  font-size:11px;
  color:#777;
  margin-top:-0.6em;
  display:block;
}

.wrapper {
  width:860px;
  margin:0 auto;
}

.figure div.img {
  text-align: center;
  border-radius: 5px;
  border: 1px solid #ddd;
  padding: 10px;
}

blockquote {
  border-left:1px solid #e5e5e5;
  margin:0;
  padding:0 0 0 20px;
  font-style:italic;
}

code, pre {
  font-family:Monaco, Bitstream Vera Sans Mono, Lucida Console, Terminal;
  color:#333;
  font-size:12px;
}

pre {
  padding:8px 15px;
  background: #f8f8f8;  
  border-radius:5px;
  border:1px solid #e5e5e5;
  overflow-x: auto;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  text-align:left;
  padding:5px 10px;
  border-bottom:1px solid #e5e5e5;
}

dt {
  color:#444;
  font-weight:700;
}

th {
  color:#444;
}

img {
  max-width:100%;
}

header {
  width:270px;
  float:left;
  /*position:fixed;*/
}

header ul {
  list-style:none;
  height:40px;
  
  padding:0;
  
  background: #eee;
  background: -moz-linear-gradient(top, #f8f8f8 0%, #dddddd 100%);
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f8f8f8), color-stop(100%,#dddddd));
  background: -webkit-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -o-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -ms-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  
  border-radius:5px;
  border:1px solid #d2d2d2;
  box-shadow:inset #fff 0 1px 0, inset rgba(0,0,0,0.03) 0 -1px 0;
  width:270px;
}

header li {
  width:89px;
  float:left;
  border-right:1px solid #d2d2d2;
  height:40px;
}

header ul a {
  line-height:1;
  font-size:11px;
  color:#999;
  display:block;
  text-align:center;
  padding-top:6px;
  height:40px;
}

strong {
  font-weight:700;
}

header ul li + li {
  width:88px;
  border-left:1px solid #fff;
}

header ul li + li + li {
  border-right:none;
  width:89px;
}

header ul a strong {
  font-size:14px;
  display:block;
  color:#222;
}

section {
  width: 60%;
  float:right;
  padding-bottom:50px;
  padding-right: 10%;
}

small {
  font-size:11px;
}

hr {
  border:0;
  background:#e5e5e5;
  height:1px;
  margin:0 0 20px;
}

footer {
  width:270px;
  float:left;
  position:fixed;
  bottom:50px;
}

header div.heading {
  display:none;
}


@media print, screen and (max-width: 960px) {
  
  div.wrapper {
    width:auto;
    margin:0;
  }
  
  header, section, footer {
    float:none;
    position:static;
    width:auto;
  }
  
  header div.heading {
    display:block;
  }
    
  section div.heading {
    display:none;
  }
  
  section {
    border:1px solid #e5e5e5;
    border-width:1px 0;
    padding:20px 0;
    margin:0 0 20px;
  }
  
  header a small {
    display:inline;
  }
  
  header ul {
    position:absolute;
    right:50px;
    top:52px;
  }
}

@media print, screen and (max-width: 720px) {
  body {
    word-wrap:break-word;
  }
  
  header {
    padding:0;
  }
  
  header ul, header p.view {
    position:static;
  }
  
  pre, code {
    word-wrap:normal;
  }
}

@media print, screen and (max-width: 480px) {
  body {
    padding:15px;
  }
  
  header ul {
    display:none;
  }
}

@media print {
  body {
    padding:0.4in;
    font-size:12pt;
    color:#444;
  }
}


.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold; } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kn { font-weight: bold } /* Keyword.Namespace */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */

.type-csharp .highlight .k { color: #0000FF }
.type-csharp .highlight .kt { color: #0000FF }
.type-csharp .highlight .nf { color: #000000; font-weight: normal }
.type-csharp .highlight .nc { color: #2B91AF }
.type-csharp .highlight .nn { color: #000000 }
.type-csharp .highlight .s { color: #A31515 }
.type-csharp .highlight .sc { color: #A31515 }


</style></head><body><header><div class="heading"><h1>midje-doc</h1><h3>write testable documentation, not literate programs</h3><hr /><div class="info"><h5>Author: Chris Zheng<b>&nbsp;&nbsp;<a href="mailto:z@caudate.me">(z@caudate.me)</a></b></h5><h5>Library: v0.0.21</h5><h5>Date: 20 April 2014</h5><h5>Website: <a href="http://www.github.com/zcaudate/lein-midje-doc">http://www.github.com/zcaudate/lein-midje-doc</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><h4><a href="#quickstart">1 &nbsp; Quickstart</a></h4><h5>&nbsp;&nbsp;<i><a href="#syntax-highlighting">1.1 &nbsp; Syntax Highlighting</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#generating-from-source">1.2 &nbsp; Generating from Source</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#installation">1.3 &nbsp; Installation</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#usage">1.4 &nbsp; Usage</a></i></h5><h4><a href="#programming-vs-documentation">2 &nbsp; Programming vs Documentation</a></h4><h4><a href="#tooling-for-documents">3 &nbsp; Tooling for Documents</a></h4><h5>&nbsp;&nbsp;<i><a href="#documentation-bugs">3.1 &nbsp; Documentation Bugs</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#test-cases-vs-docstrings">3.2 &nbsp; Test Cases vs Docstrings</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#bridging-the-divide">3.3 &nbsp; Bridging the Divide</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#features">3.3.1 &nbsp; Features</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#benefits">3.3.2 &nbsp; Benefits</a></i></h5><h4><a href="#api-reference">4 &nbsp; API Reference</a></h4><h5>&nbsp;&nbsp;<i><a href="#the-basics">4.1 &nbsp; The Basics</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#elements">4.1.1 &nbsp; elements</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#attributes">4.1.2 &nbsp; attributes</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#sectioning-elements">4.2 &nbsp; Sectioning Elements</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#content-elements">4.3 &nbsp; Content Elements</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#paragraph">4.3.1 &nbsp; :paragraph</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#:image">4.3.2 &nbsp; :image</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#:file">4.3.3 &nbsp; :file</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#code-elements">4.4 &nbsp; Code Elements</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#normal-s-expressions">4.4.1 &nbsp; normal s-expressions</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#facts-form">4.4.2 &nbsp; facts form</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#fact-form">4.4.3 &nbsp; fact form</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#comments">4.4.4 &nbsp; comments</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#:code">4.4.5 &nbsp; :code</a></i></h5><h4><a href="#a-bugs-life">5 &nbsp; A Bug's Life</a></h4><h5>&nbsp;&nbsp;<i><a href="#version-one">5.1 &nbsp; Version One</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#version-two">5.2 &nbsp; Version Two</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#the-bug-surfaces">5.3 &nbsp; The Bug Surfaces</a></i></h5><h4><a href="#end-notes">6 &nbsp; End Notes</a></h4><br /></header><section><div class="heading"><h1>midje-doc</h1><h3>write testable documentation, not literate programs</h3><hr /><div class="info"><h5>Author: Chris Zheng<b>&nbsp;&nbsp;<a href="mailto:z@caudate.me">(z@caudate.me)</a></b></h5><h5>Library: v0.0.21</h5><h5>Date: 20 April 2014</h5><h5>Website: <a href="http://www.github.com/zcaudate/lein-midje-doc">http://www.github.com/zcaudate/lein-midje-doc</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><div><a name="quickstart"></a><h2><b>1 &nbsp;&nbsp; Quickstart</b></h2></div><div><p><code>lein-midje-doc</code> can be used to generate documents with code examples from <code>midje</code> test files. For motivation, see <a href='#programming-vs-documentation'>chapter 2</a> and <a href='#tooling-for-documents'>chapter  3</a>. For api descriptions, see <a href='#api-reference'>chapter 4</a>. <a href='https://www.github.com/zcaudate/lein-midje-doc'><code>lein-midje-doc</code></a> has been used to generate its own documention. The source can be found <a href='https://github.com/zcaudate/lein-midje-doc/blob/master/test/midje&#95;doc/midje&#95;doc&#95;guide.clj'>here</a>.</p></div><div><a name="syntax-highlighting"></a><h3>1.1 &nbsp;&nbsp; Syntax Highlighting</h3></div><div><p>For syntax hightlighting of code examples, the pygments python package should be installed. Make sure that the directory containing <code>pygmentize</code> is in your <code>PATH</code> settings.</p></div><div><a name="generating-from-source"></a><h3>1.2 &nbsp;&nbsp; Generating from Source</h3></div><div><p> The html documentation can be generated after downloading the project:</p></div><div><div class="highlight"><pre>&gt; git clone https://github.com/zcaudate/lein-midje-doc.git
&gt; <span class="nb">cd </span>lein-midje-doc
&gt; lein midje-doc once
&gt; open ./index.html
</pre></div>
</div><div><a name="installation"></a><h3>1.3 &nbsp;&nbsp; Installation</h3></div><div><p><code>lein-midje-doc</code> is a leiningen plugin. Install by adding entries in <code>&#126;/.lein/profiles.clj</code>:</p><pre>
 {:user {:plugins ...
         &#91;lein-midje-doc &quot;0.0.21&quot;&#93;
         &#91;lein-midje     &quot;3.0.1&quot;&#93;
         ...}}
</pre></div><div><a name="usage"></a><h3>1.4 &nbsp;&nbsp; Usage</h3></div><div><p><ol><li>Start with a new or existing project.</li><li>In <code>project.clj</code> make sure that <code>midje</code> is in the dependencies and place a <code>:documentation</code> entry in the <code>defproject</code> form (<a href='#qs-project'>e.1.1</a>).</li><li>Create a file in <code>test/docs/my&#95;first&#95;document.clj</code> (<a href='#qs-first-doc'>e.1.2</a>).</li><li>Run <code>lein midje-doc</code> in a terminal within your project folder.</li><li>The output documentation should be generated within the project directory as <code>/my-first-document.html</code>. An example of how this should look can be seen <a href='http://z.caudate.me/lein-midje-doc/my-first-document.html'>here</a></li><li>Run <code>lein midje :autotest</code> in another terminal window. This will ensure that the documentation is correct.</li><li>Use <code>live-reload</code> for the best experience of live documenting</li></ol></div><div><a name="qs-project"></a><h4><i>e.1.1  &nbsp;-&nbsp; project.clj</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">defproject </span><span class="nv">...</span>
  <span class="nv">...</span>
  <span class="ss">:profiles</span> <span class="p">{</span><span class="ss">:dev</span> <span class="p">{</span><span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">midje</span> <span class="s">&quot;1.5.1&quot;</span><span class="p">]]}}</span>
  <span class="nv">...</span>
  <span class="ss">:documentation</span>
  <span class="p">{</span><span class="ss">:files</span> <span class="p">{</span><span class="s">&quot;&lt;document-name&gt;&quot;</span>             <span class="c1">;; my-first-document</span>
           <span class="p">{</span><span class="ss">:input</span> <span class="s">&quot;&lt;input-file-path&gt;&quot;</span>   <span class="c1">;; test/docs/my_first_document.clj</span>
            <span class="ss">:title</span> <span class="s">&quot;&lt;title&gt;&quot;</span>             <span class="c1">;; My First Document</span>
            <span class="ss">:sub-title</span> <span class="s">&quot;&lt;sub title&gt;&quot;</span>     <span class="c1">;; Learning how to use midje-doc</span>
            <span class="ss">:author</span> <span class="s">&quot;&lt;name&gt;&quot;</span>
            <span class="ss">:email</span>  <span class="s">&quot;&lt;email&gt;&quot;</span><span class="p">}}}</span>
  <span class="nv">...</span><span class="p">)</span>
</pre></div>
</div><div><a name="qs-first-doc"></a><h4><i>e.1.2  &nbsp;-&nbsp; test/docs/my_first_document.clj</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">docs.my-first-document</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">midje.sweet</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>

<span class="p">[[</span><span class="ss">:chapter</span> <span class="p">{</span><span class="ss">:tag</span> <span class="s">&quot;hello&quot;</span> <span class="ss">:title</span> <span class="s">&quot;Hello Midje Doc&quot;</span><span class="p">}]]</span>

<span class="s">&quot;This is an introduction to writing with midje-doc.&quot;</span>

<span class="p">[[</span><span class="ss">:section</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Defining a function&quot;</span><span class="p">}]]</span>

<span class="s">&quot;We define function `add-5`&quot;</span>

<span class="p">[[{</span><span class="ss">:numbered</span> <span class="nv">false</span><span class="p">}]]</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">add-5</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">5</span><span class="p">))</span>

<span class="p">[[</span><span class="ss">:section</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Testing a function&quot;</span><span class="p">}]]</span>

<span class="s">&quot;`add-5` outputs the following results seen in</span>
<span class="s"> [e.{{add-5-1}}](#add-5-1) and [e.{{add-5-10}}](#add-5-10):&quot;</span>

<span class="p">(</span><span class="nf">fact</span>
  <span class="p">[[{</span><span class="ss">:tag</span> <span class="s">&quot;add-5-1&quot;</span> <span class="ss">:title</span> <span class="s">&quot;1 add 5 = 6&quot;</span><span class="p">}]]</span>
  <span class="p">(</span><span class="nf">add-5</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">6</span>

  <span class="p">[[{</span><span class="ss">:tag</span> <span class="s">&quot;add-5-10&quot;</span> <span class="ss">:title</span> <span class="s">&quot;10 add 5 = 15&quot;</span><span class="p">}]]</span>
  <span class="p">(</span><span class="nf">add-5</span> <span class="mi">10</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div><div><a name="programming-vs-documentation"></a><h2><b>2 &nbsp;&nbsp; Programming vs Documentation</b></h2></div><div><p>The phrase 'Literate Programming' has been very popular lately. The main idea is that the code is written in a way that allows both a machine <em>and</em> a person to understand what is going on. Most people seem to agree that it is a great idea.</p><p>However Humans and machines are fundamentally different and rely on completely different methods of communication:</p><ul><li>Communication to Machines are usually very linear and procedural. It involves giving them a specific set of instructions. First Do This, Then Do That.... Machines don't really care what the code does. It just executes whatever code it has been given.<p></li></ul><ul><li>Communication to Humans usually take a very different form. We wish to be engaged, inspired and taught, not given a sequence of instructions that each break down to even smaller sequences. The best documentation are usally seperated into logical sections like an <code>overview</code>, <code>table of contents</code>, <code>list of figures</code>, <code>topic chapters</code>, <code>subsections</code>. There are <code>text</code>, <code>code</code>, <code>pictures</code>, even <code>sound</code> and <code>video</code>. Documentation structure resemble trees, with links between content that connect related topics and content. They do not resemble program code and therefore should be created independently of the machine code itself.</li></ul><strong>In short:</strong> Machines are programmed while humans are engaged, inspired and taught. <em>Programs</em> are written linearly for machines. <em>Documentation</em> are written like a woven lattice for humans. The fundamental structure of programs and documentation are very different from each other. Therefore, thinking that documentation can be automatically generated from doc-strings is a <strong>mechanistic</strong> approach not a <strong>humanistic</strong> one. Documents should be written for people, not machines. Our tools for documentation should reflect this as well.</p></div><div><a name="tooling-for-documents"></a><h2><b>3 &nbsp;&nbsp; Tooling for Documents</b></h2></div><div><a name="documentation-bugs"></a><h3>3.1 &nbsp;&nbsp; Documentation Bugs</h3></div><div><p>Programming is a very precise art form. Programming mistakes, especially the little ones, can result in dire consequences and much wasted time. We therefore use tools such as debuggers, type checkers and test frameworks to make our coding lives easier and our source code correct.</p><p>Documentation is the programmers' means of communicating how to use or build upon a library, usually to a larger audience of peers. This means that any mistakes in the documentation results in wasted time for <em>all involved</em>. Therefore any mistake in documentation can have a <em>greater effect</em> than a mistake in source code because it wastes <em>everybody's</em> time.</p><p>There are various tools for documentation like <code>latex</code>, <code>wiki</code> and <code>markdown</code>. However, none address the issue that code examples in the documentation are not checked for correctness. A fictitious example illustrates how errors in documentation can produced and propagated can be seen in <a href='#a-bugs-life'>chapter 5</a></p></div><div><a name="test-cases-vs-docstrings"></a><h3>3.2 &nbsp;&nbsp; Test Cases vs Docstrings</h3></div><div><p>The best description for our functions are not found in <em>source files</em> but in the <em>test files</em>. Test files <em>are</em> potentially the best documentation because they provide information about what a function outputs, what inputs it accepts and what exceptions it throws. Instead of writing vague phrases (<a href='#split-source'>e.3.1</a>) in the doc-string, we can write the descriptions of what a function does directly with our tests (<a href='#split-tests'>e.3.2</a>).</p></div><div><a name="split-source"></a><h4><i>e.3.1  &nbsp;-&nbsp; source code (how to do something)</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">split-string</span>
  <span class="s">&quot;The split-string function is used to split a string</span>
<span class="s">  in two according to the idx that is passed.&quot;</span>
  <span class="p">[</span><span class="nv">s</span> <span class="nv">idx</span><span class="p">]</span>
  <span class="p">[(</span><span class="nf">.substring</span> <span class="nv">s</span> <span class="mi">0</span> <span class="nv">idx</span><span class="p">)</span> <span class="p">(</span><span class="nf">.substring</span> <span class="nv">s</span> <span class="nv">idx</span><span class="p">)])</span>
</pre></div>
</div><div><a name="split-tests"></a><h4><i>e.3.2  &nbsp;-&nbsp; test code (how something is used)</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">facts</span> <span class="s">&quot;split-string usage:&quot;</span>

  <span class="p">(</span><span class="nf">split-string</span> <span class="s">&quot;abcde&quot;</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;a&quot;</span> <span class="s">&quot;bcde&quot;</span><span class="p">]</span>

  <span class="p">(</span><span class="nf">split-string</span> <span class="s">&quot;abcde&quot;</span> <span class="mi">3</span><span class="p">)</span>
  <span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;abc&quot;</span> <span class="s">&quot;de&quot;</span><span class="p">])</span>
</pre></div>
</div><div><p>It can be seen that test cases provides a much better explaination for <code>split-string</code> than the source doc-string. The irony however is that when a readme says: <em><code>'for documentation, please read the test files'</code></em>, the common consensus is that the project developer is too slack to write proper documentation. However, if we are truly honest with our own faults, this occurs because most programmers are too slack to read tests. <strong>We only want to read pretty documentation.</strong></p></div><div><a name="bridging-the-divide"></a><h3>3.3 &nbsp;&nbsp; Bridging the Divide</h3></div><div><p><code>lein-midje-doc</code> plugin attempts to bridge the gap between writing tests and writing documentation by introducing three novel features:</p></div><div><a name="features"></a><h3><i>3.3.1 &nbsp;&nbsp; Features</i></h3></div><div><p>The features are:<ol><li>To generate <code>.html</code> documentation from a <code>.clj</code> test file.</li><li>To express documentation elements as clojure datastructures.</li><li>To render clojure code and midje facts as code examples.</li><li>To allow tagging of elements for numbering and linking. </li></ol></p></div><div><a name="benefits"></a><h3><i>3.3.2 &nbsp;&nbsp; Benefits</i></h3></div><div><p>In this way, the programmer as well as all users of the library benefits:</p><ol><li>All documentation errors can be eliminated.</li><li>Removes the need to cut and copy test examples into a readme file.</li><li>Entire test suites can potentially be turned into nice looking documentation with relatively little work. </li></ol></div><div><a name="api-reference"></a><h2><b>4 &nbsp;&nbsp; API Reference</b></h2></div><div><a name="the-basics"></a><h3>4.1 &nbsp;&nbsp; The Basics</h3></div><div><a name="elements"></a><h3><i>4.1.1 &nbsp;&nbsp; elements</i></h3></div><div><p>Elements are constructed using a tag and a map contained within double square brackets. The format is shown in (<a href='#elements-ex1'>e.4.1</a>). Elements tags have been inspired from latex:<ul><li><a href='#sectioning-elements'>Sectioning Elements</a></li><li><a href='#text-elements'>Text Elements</a></li><li><a href='#code-elements'>Code Elements</a></li><li><a href='#additional-elements'>Additional Elements</a></li></ul>Clojure strings are treated as paragraph elements whilst clojure forms are treated as code elements. <code>fact</code> and <code>comment</code> forms are also considered code elements. Elements will be described in detail in their respective sections.</p></div><div><a name="elements-ex1"></a><h4><i>e.4.1  &nbsp;-&nbsp; Element Notation</i></h4><div class="highlight"><pre><span class="p">[[</span><span class="nv">&lt;tag&gt;</span> <span class="p">{</span><span class="nv">&lt;key1&gt;</span> <span class="nv">&lt;value1&gt;</span>, <span class="nv">&lt;key2&gt;</span> <span class="nv">&lt;value2&gt;</span><span class="p">}]]</span>

<span class="nb">for </span><span class="nv">example</span>

<span class="p">[[</span><span class="ss">:chapter</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Hello World&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;hello&quot;</span><span class="p">}]]</span>
</pre></div>
</div><div><a name="attributes"></a><h3><i>4.1.2 &nbsp;&nbsp; attributes</i></h3></div><div><p>Attribute add additional meta-data to elements. They are written as a single hashmap within double square brackets. Attributes mean nothing by themselves. They change the properties of elements directly after them (<a href='#attributes-ex1'>e.4.2</a>). Multiple attributes can be stacked to modify an element (<a href='#attributes-ex2'>e.4.3</a>).</p></div><div><hr/></div><div><a name="attributes-ex1"></a><h4><i>e.4.2  &nbsp;-&nbsp; Attribute Notation</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:tag</span> <span class="s">&quot;my-paragraph&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:paragraph</span> <span class="p">{</span><span class="ss">:content</span> <span class="s">&quot;This is a paragraph&quot;</span><span class="p">}]]</span>

<span class="nv">is</span> <span class="nv">equivalent</span> <span class="nv">to</span>

<span class="p">[[</span><span class="ss">:paragraph</span> <span class="p">{</span><span class="ss">:content</span> <span class="s">&quot;This is a paragraph&quot;</span>
              <span class="ss">:tag</span> <span class="s">&quot;my-paragraph&quot;</span><span class="p">}]]</span>
</pre></div>
</div><div><hr/></div><div><a name="attributes-ex2"></a><h4><i>e.4.3  &nbsp;-&nbsp; Stacked Attributes</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:numbered</span> <span class="nv">false</span><span class="p">}]]</span>
<span class="p">[[{</span><span class="ss">:lang</span> <span class="s">&quot;python&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:code</span> <span class="s">&quot;</span>
<span class="s">a = 1 + 1</span>
<span class="s">print a   # outputs 2</span>
<span class="s">&quot;</span><span class="p">]]</span>

<span class="nv">produces</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">python</span> <span class="nv">code</span>
</pre></div>
</div><div><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   <span class="c"># outputs 2</span>
</pre></div>
</div><div><hr/></div><div><a name="sectioning-elements"></a><h3>4.2 &nbsp;&nbsp; Sectioning Elements</h3></div><div><p>Sectioning elements are taken from latex and allow the document to be organised into logical sections. From highest to lowest order of priority, they are: <code>:chapter</code>, <code>section</code>, <code>subsection</code> and <code>:subsubsection</code>, giving four levels of organisation.</p><p>The numbering for elements are generated in sequencial order: <code>&#40;1, 2, 3 ... etc&#41;</code> and a tag can be generated from the title or specified for creating links within the document. <code>:chapter</code>, <code>section</code> and <code>subsection</code> elements are list in the table of contents using tags.</p><p>For example, I wish to write a chapter about animals and have organised content into categories shown in (<a href='#animal-categories'>e.4.4</a>), it is very straight forward to turn this into sectioning elements (<a href='#animal-elements'>e.4.5</a>) which will then generate the sectioning numbers for the categories as well as their tags listed as a  comment (<a href='#animal-generated-numbering'>e.4.6</a>):</p></div><div><a name="animal-categories"></a><h4><i>e.4.4  &nbsp;-&nbsp; Animal Categories</i></h4><div class="highlight"><pre><span class="nv">Animals</span>
<span class="nb">- </span><span class="nv">Mammals</span>
<span class="nb">- </span><span class="nv">Birds</span>
<span class="nv">*-</span> <span class="nv">Can</span> <span class="nv">Fly</span>
<span class="nv">**-</span> <span class="nv">Eagle</span>
<span class="nv">**-</span> <span class="nv">Hummingbird</span>
<span class="nv">*-</span> <span class="nv">Flightless</span>
<span class="nv">**-</span> <span class="nv">Penguin</span>
</pre></div>
</div><div><a name="animal-elements"></a><h4><i>e.4.5  &nbsp;-&nbsp; Animal Elements</i></h4><div class="highlight"><pre><span class="p">[[</span><span class="ss">:chapter</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Animals&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:section</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Mammals&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:section</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Birds&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:subsection</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Can Fly&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:subsubsection</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Eagle&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:subsubsection</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Hummingbird&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:subsection</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Flightless&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:subsubsection</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Penguin&quot;</span><span class="p">}]]</span>
</pre></div>
</div><div><a name="animal-generated-numbering"></a><h4><i>e.4.6  &nbsp;-&nbsp; Animal Generated Numbering</i></h4><div class="highlight"><pre><span class="mi">1</span> <span class="nv">Animals</span>                  <span class="c1">;; animals</span>
  <span class="mf">1.1</span> <span class="nv">Mammals</span>              <span class="c1">;; mammals</span>
  <span class="mf">1.2</span> <span class="nv">Birds</span>                <span class="c1">;; birds</span>
    <span class="mf">1.2</span><span class="nv">.1</span> <span class="nv">Can</span> <span class="nv">Fly</span>          <span class="c1">;; can-fly</span>
      <span class="mf">1.2</span><span class="nv">.1.1</span> <span class="nv">Eagle</span>        <span class="c1">;; eagle</span>
      <span class="mf">1.2</span><span class="nv">.1.2</span> <span class="nv">Hummingbird</span>  <span class="c1">;; hummingbird</span>
    <span class="mf">1.2</span><span class="nv">.2</span> <span class="nv">Flightless</span>       <span class="c1">;; flightless</span>
      <span class="mf">1.2</span><span class="nv">.2.1</span> <span class="nv">Penguin</span>      <span class="c1">;; penguin</span>
</pre></div>
</div><div><a name="content-elements"></a><h3>4.3 &nbsp;&nbsp; Content Elements</h3></div><div><p>Content elements include <code>:paragraph</code>, <code>:image</code>, and <code>file</code> elements.</p></div><div><a name="paragraph"></a><h3><i>4.3.1 &nbsp;&nbsp; :paragraph</i></h3></div><div><p>Paragraph elements should make up the bulk of the documentation. They can be written as an element (<a href='#paragraph-element'>e.4.7</a>) or in the usual case, as a string (<a href='#paragraph-string'>e.4.8</a>). The string is markdown with templating - so that chapter, section, code and image numbers can be referred to by their tags (<a href='#markdown-string'>e.4.9</a>).</p></div><div><a name="paragraph-element"></a><h4><i>e.4.7  &nbsp;-&nbsp; Paragraph Element</i></h4><div class="highlight"><pre><span class="p">[[</span><span class="ss">:paragraph</span> <span class="p">{</span><span class="ss">:content</span> <span class="s">&quot;Here is some content&quot;</span><span class="p">}]]</span>
</pre></div>
</div><div><a name="paragraph-string"></a><h4><i>e.4.8  &nbsp;-&nbsp; Paragraph String</i></h4><div class="highlight"><pre><span class="s">&quot;Here is some content&quot;</span>
</pre></div>
</div><div><a name="markdown-string"></a><h4><i>e.4.9  &nbsp;-&nbsp; Markdown String</i></h4><div class="highlight"><pre><span class="p">[[</span><span class="ss">:chapter</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Chapter Heading&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;ch-heading&quot;</span><span class="p">}]]</span>

<span class="s">&quot;</span>
<span class="s"># Heading One</span>
<span class="s">Here is some text.</span>
<span class="s">Here is a tag reference to Chapter Heading - {{ch-heading}}</span>

<span class="s">- Here is a bullet point</span>
<span class="s">- Here is another one&quot;</span>
</pre></div>
</div><div><a name=":image"></a><h3><i>4.3.2 &nbsp;&nbsp; :image</i></h3></div><div><p>The <code>:image</code> element embeds an image as a figure within the document. It is numbered and can be tagged for easy reference. The code example in (<a href='#clojure-logo-element'>e.4.10</a>) produces the image seen in <a href='#clojure-logo'>Figure 1</a>.</p></div><div><a name="clojure-logo-element"></a><h4><i>e.4.10  &nbsp;-&nbsp; :image tag example</i></h4><div class="highlight"><pre><span class="p">[[</span><span class="ss">:image</span> <span class="p">{</span><span class="ss">:tag</span> <span class="s">&quot;clojure-logo&quot;</span> <span class="ss">:title</span> <span class="s">&quot;Clojure Logo (source clojure.org)&quot;</span>
          <span class="ss">:src</span> <span class="s">&quot;http://clojure.org/space/showimage/clojure-icon.gif&quot;</span><span class="p">}]]</span>
</pre></div>
</div><div class="figure"><a name="clojure-logo"></a><h4><i>fig.1  &nbsp;-&nbsp; Clojure Logo (source clojure.org)</i></h4><div class="img"><img src="http://clojure.org/space/showimage/clojure-icon.gif" title="Clojure Logo (source clojure.org)" /></div><p /></div><div><a name=":file"></a><h3><i>4.3.3 &nbsp;&nbsp; :file</i></h3></div><div><p>The <code>:file</code> element allows inclusion of other files into the document. It is useful for breaking up a document into managable chunks. A file element require that the <code>:src</code> attribute be specified. A high-level view of a document can thus be achieved, making the source more readable (<a href='#file-element'>e.4.11</a>). This is similar to the <code>\include</code> element in latex.</p></div><div><a name="file-element"></a><h4><i>e.4.11  &nbsp;-&nbsp; :file tag example</i></h4><div class="highlight"><pre><span class="p">[[</span><span class="ss">:file</span> <span class="p">{</span><span class="ss">:src</span> <span class="s">&quot;test/docs/first_section.clj&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:file</span> <span class="p">{</span><span class="ss">:src</span> <span class="s">&quot;test/docs/second_section.clj&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:file</span> <span class="p">{</span><span class="ss">:src</span> <span class="s">&quot;test/docs/third_section.clj&quot;</span><span class="p">}]]</span>
</pre></div>
</div><div><a name="code-elements"></a><h3>4.4 &nbsp;&nbsp; Code Elements</h3></div><div><p>Code displayed in documentation are of a few types:</p><ol><li>Code that needs to be run (normal clojure code)</li><li>Code that needs verification taking input and showing output. (midje fact)</li><li>Code that should not be run (namespace declaration examples)</li><li>Code in other languages</li></ol><p>The different types of code can be defined so that code examples render properly using a variety of methods</p></div><div><a name="normal-s-expressions"></a><h3><i>4.4.1 &nbsp;&nbsp; normal s-expressions</i></h3></div><div><p>Normal s-expressions are rendered as is. Attributes can be added for grouping purposes. The source code shown in (<a href='#c-add-src'>e.4.12</a>) would render the outputs (<a href='#c-add-1'>e.4.13</a>) and (<a href='#c-add-2'>e.4.14</a>)</p></div><div><a name="c-add-src"></a><h4><i>e.4.12  &nbsp;-&nbsp; seperating code blocks through attributes</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:title</span> <span class="s">&quot;add-n definition&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-add-1&quot;</span><span class="p">}]]</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">add-n</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">n</span><span class="p">)))</span>

<span class="p">[[{</span><span class="ss">:title</span> <span class="s">&quot;add-4 and add-5 definitions&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-add-2&quot;</span><span class="p">}]]</span>
<span class="p">(</span><span class="k">def </span><span class="nv">add-4</span> <span class="p">(</span><span class="nf">add-n</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">add-5</span> <span class="p">(</span><span class="nf">add-n</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div><div><a name="c-add-1"></a><h4><i>e.4.13  &nbsp;-&nbsp; add-n definition</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">add-n</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">n</span><span class="p">)))</span>
</pre></div>
</div><div><a name="c-add-2"></a><h4><i>e.4.14  &nbsp;-&nbsp; add-4 and add-5 definitions</i></h4><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">add-4</span> <span class="p">(</span><span class="nf">add-n</span> <span class="mi">4</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">add-5</span> <span class="p">(</span><span class="nf">add-n</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div><div><a name="facts-form"></a><h3><i>4.4.2 &nbsp;&nbsp; facts form</i></h3></div><div><p>Documentation examples put in <code>facts</code> forms allows the code to be verified for correctness using <code>lein midje</code>. Document element notation still be rendered except before and after the midje arrows (<strong>=&gt;</strong>). Consecutive code within a fact form will stacked as one common code block. An example is given below where the source (<a href='#c-facts-src'>e.4.15</a>) gives two outputs: (<a href='#c-facst-1'>e.4.16</a>) and (<a href='#c-facts-2'>e.</a>)</p></div><div><a name="c-facts-src"></a><h4><i>e.4.15  &nbsp;-&nbsp; Facts Form Source</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:tag</span> <span class="s">&quot;facts-form-output&quot;</span> <span class="ss">:title</span> <span class="s">&quot;Facts Form Output&quot;</span><span class="p">}]]</span>
<span class="p">(</span><span class="nf">facts</span>
  <span class="p">[[{</span><span class="ss">:title</span> <span class="s">&quot;Definining an atom&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-facts-1&quot;</span><span class="p">}]]</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">1</span>

  <span class="p">[[{</span><span class="ss">:title</span> <span class="s">&quot;Updating the atom&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-facts-2&quot;</span><span class="p">}]]</span>
  <span class="p">(</span><span class="nf">swap!</span> <span class="nv">a</span> <span class="nv">inc</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div><div><a name="c-facts-1"></a><h4><i>e.4.16  &nbsp;-&nbsp; Definining an atom</i></h4><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span>

<span class="nv">=&gt;</span> <span class="mi">1</span>
</pre></div>
</div><div><a name="c-factss-2"></a><h4><i>e.4.17  &nbsp;-&nbsp; Updating the atom</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">swap!</span> <span class="nv">a</span> <span class="nv">inc</span><span class="p">)</span>

<span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span>

<span class="nv">=&gt;</span> <span class="mi">2</span>
</pre></div>
</div><div><a name="fact-form"></a><h3><i>4.4.3 &nbsp;&nbsp; fact form</i></h3></div><div><p>For an entire block to be embedded in code, use the <code>fact</code> form. The source (<a href='#c-fact-src'>e.4.18</a>) will render the output (<a href='#fact-form-output'>e.4.19</a>)</p></div><div><a name="c-fact-src"></a><h4><i>e.4.18  &nbsp;-&nbsp; Fact Form Source</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:tag</span> <span class="s">&quot;fact-form-output&quot;</span> <span class="ss">:title</span> <span class="s">&quot;Fact Form Output&quot;</span><span class="p">}]]</span>
<span class="p">(</span><span class="nf">fact</span>
  <span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">1</span>

  <span class="p">(</span><span class="nf">swap!</span> <span class="nv">a</span> <span class="nb">inc </span><span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div><div><a name="fact-form-output"></a><h4><i>e.4.19  &nbsp;-&nbsp; Fact Form Output</i></h4><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">1</span>

<span class="p">(</span><span class="nf">swap!</span> <span class="nv">a</span> <span class="nv">inc</span><span class="p">)</span>
<span class="p">(</span><span class="nb">deref </span><span class="nv">a</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">2</span>
</pre></div>
</div><div><a name="comments"></a><h3><i>4.4.4 &nbsp;&nbsp; comments</i></h3></div><div><p>Comments are clojure's built-in method of displaying non-running code and so this mechanisim is used in clojure for displaying code that should not be run, but still requires display. For example, (<a href='#c-com-src'>e.4.20</a>) will output (<a href='#c-com-1'>e.4.21</a>) without interferring with the midje tests.</p></div><div><a name="c-com-src"></a><h4><i>e.4.20  &nbsp;-&nbsp; Switching to a new namespace</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:title</span> <span class="s">&quot;Switching to a new namespace&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-com-1&quot;</span><span class="p">}]]</span>
<span class="p">(</span><span class="nf">comment</span>
  <span class="p">(</span><span class="nb">in-ns </span><span class="ss">&#39;hello.world</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;clojure.string</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">split</span> <span class="s">&quot;Hello World&quot;</span> <span class="o">#</span><span class="s">&quot;\s&quot;</span><span class="p">)</span> <span class="c1">;=&gt; [&quot;Hello&quot; &quot;World&quot;]</span>
  <span class="p">)</span>
</pre></div>
</div><div><a name="c-com-1"></a><h4><i>e.4.21  &nbsp;-&nbsp; Switching to a new namespace</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nb">in-ns </span><span class="ss">&#39;hello.world</span><span class="p">)</span>
<span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;clojure.string</span><span class="p">)</span>
<span class="p">(</span><span class="nf">split</span> <span class="s">&quot;Hello World&quot;</span> <span class="o">#</span><span class="s">&quot;\s&quot;</span><span class="p">)</span> <span class="c1">;=&gt; [&quot;Hello&quot; &quot;World&quot;]</span>
</pre></div>
</div><div><a name=":code"></a><h3><i>4.4.5 &nbsp;&nbsp; :code</i></h3></div><div><p>The most generic way of displaying code is with the <code>:code</code> tag. It is useful when code in other languages are required to be in the documentation.</p></div><div><a name="python-example"></a><h3><i>4.4.5.1 &nbsp;&nbsp; Python Example</i></h3></div><div><p>The source and outputs are listed below:</p></div><div><a name="c-py-src"></a><h4><i>e.4.22  &nbsp;-&nbsp; Python for Loop Source</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:lang</span> <span class="s">&quot;python&quot;</span> <span class="ss">:title</span> <span class="s">&quot;Python for Loop&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-py-1&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:code</span>
  <span class="s">&quot;</span>
<span class="s">myList = [1,2,3,4]</span>
<span class="s">for index in range(len(myList)):</span>
<span class="s">  myList[index] += 1</span>
<span class="s">print myList</span>
<span class="s">&quot;</span>
  <span class="p">]]</span>
</pre></div>
</div><div><a name="c-py-1"></a><h4><i>e.4.23  &nbsp;-&nbsp; Python for Loop</i></h4><div class="highlight"><pre><span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">myList</span><span class="p">)):</span>
    <span class="n">myList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">print</span> <span class="n">myList</span>
</pre></div>
</div><div><a name="ruby-example"></a><h3><i>4.4.5.2 &nbsp;&nbsp; Ruby Example</i></h3></div><div><p>The source and outputs are listed below:</p></div><div><a name="c-rb-src"></a><h4><i>e.4.24  &nbsp;-&nbsp; Ruby for Loop Source</i></h4><div class="highlight"><pre><span class="p">[[{</span><span class="ss">:lang</span> <span class="s">&quot;ruby&quot;</span> <span class="ss">:title</span> <span class="s">&quot;Ruby for Loop&quot;</span> <span class="ss">:tag</span> <span class="s">&quot;c-rb-2&quot;</span><span class="p">}]]</span>
<span class="p">[[</span><span class="ss">:code</span>
  <span class="s">&quot;</span>
<span class="s">array.each_with_index do |element,index|</span>
<span class="s">element.do_stuff(index)</span>
<span class="s">end</span>
<span class="s">&quot;</span>
  <span class="p">]]</span>
</pre></div>
</div><div><a name="c-rb-2"></a><h4><i>e.4.25  &nbsp;-&nbsp; Ruby for Loop</i></h4><div class="highlight"><pre><span class="n">array</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="p">,</span><span class="n">index</span><span class="o">|</span>
  <span class="n">element</span><span class="o">.</span><span class="n">do_stuff</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div><div><a name="a-bugs-life"></a><h2><b>5 &nbsp;&nbsp; A Bug's Life</b></h2></div><div><a name="version-one"></a><h3>5.1 &nbsp;&nbsp; Version One</h3></div><div><p>A new clojure project is created.</p></div><div><div class="highlight"><pre>&gt; lein new fami  
&gt; <span class="nb">cd </span>fami
&gt; lein repl
</pre></div>
</div><div><p>A very useful function <a href='#add-5-fn'><code>add-5</code></a> has been defined <a href='#add-5-fn'>(e.5.1)</a> and the  corresponding tests specified <a href='#add-5-tests'>(e.5.2)</a>. There are additional entries for <a href='#add-5-fn'><code>add-5</code></a> in the readme as well as also being scattered around in the readme and various other documents <a href='#add-5-readme'>(e.5.3)</a>. </p><p>This version of this library has been released as <strong>version 1.0</strong></p></div><div><a name="add-5-fn"></a><h4><i>e.5.1  &nbsp;-&nbsp; src/fami/operations.clj</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">fami.operations</span><span class="p">)</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">add-5</span> 
<span class="s">&quot;add-5 is a function that takes any number of arguments </span>
<span class="s"> and adds 5 to the sum&quot;</span>
<span class="p">[</span><span class="o">&amp;</span> <span class="nv">ns</span><span class="p">]</span>
<span class="p">(</span><span class="nb">apply + </span><span class="mi">5</span> <span class="nv">ns</span><span class="p">))</span>
</pre></div>
</div><div><a name="add-5-tests"></a><h4><i>e.5.2  &nbsp;-&nbsp; src/fami/test-operations.clj</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">fami.test-operations</span>
<span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">fami.operations</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
          <span class="p">[</span><span class="nv">midje.sweet</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>

<span class="p">(</span><span class="nf">fact</span> <span class="s">&quot;add-5 should increment any list of numbers by 5&quot;</span>
<span class="p">(</span><span class="nf">add-5</span> <span class="mi">5</span><span class="p">)</span>  <span class="nv">=&gt;</span> <span class="mi">10</span>
<span class="p">(</span><span class="nf">add-5</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div><div><a name="add-5-readme"></a><h4><i>e.5.3  &nbsp;-&nbsp; readme.md, operations.md</i></h4><div class="highlight"><pre><span class="nv">...</span>

<span class="nv">Here</span> <span class="nv">are</span> <span class="nb">some </span><span class="nv">of</span> <span class="nv">the</span> <span class="nv">use</span> <span class="nv">cases</span> <span class="nb">for </span><span class="nv">add-5</span>

<span class="p">(</span><span class="nf">add-5</span> <span class="mi">5</span><span class="p">)</span>    <span class="c1">;; =&gt; 10</span>
<span class="p">(</span><span class="nf">add-5</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>   <span class="c1">;; =&gt; 15</span>

<span class="nv">...</span>
</pre></div>
</div><div><a name="version-two"></a><h3>5.2 &nbsp;&nbsp; Version Two</h3></div><div><p>The library is super successful with many users. The code undergoes refactoring and it is decided that the original <code>add-5</code> <a href='#add-5-fn'>(e.5.1)</a> is too powerful and so it must be muted to only accept one argument. An additional function <code>add-5-multi</code> is used to make explicit that the function is taking multiple arguments <a href='#add-5-v2'>(e.5.4)</a>. The tests throw an exception <a href='#add-5-v2-failure'>(e.5.5)</a>, and are quickly fixed <a href='#add-5-v2-tests'>(e.5.6)</a></p><p>This version of this library has been released as <strong>version 2.0</strong></p></div><div><a name="add-5-v2"></a><h4><i>e.5.4  &nbsp;-&nbsp; src/fami/operations.clj &nbsp;-&nbsp; v2</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">fami.operations</span><span class="p">)</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">add-5</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>   <span class="c1">;; The muted version</span>
<span class="s">&quot;add-5 is a function that takes a number and adds 5 to it&quot;</span>
<span class="p">(</span><span class="nb">+ </span><span class="nv">n</span> <span class="mi">5</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">add-5-multi</span> 
<span class="s">&quot;add-5-multi is a function that takes any number of arguments </span>
<span class="s"> and adds 5 to the sum&quot;</span>
<span class="p">[</span><span class="o">&amp;</span> <span class="nv">ns</span><span class="p">]</span>
<span class="p">(</span><span class="nb">apply + </span><span class="mi">5</span> <span class="nv">ns</span><span class="p">))</span>
</pre></div>
</div><div><a name="add-5-v2-failure"></a><h4><i>e.5.5  &nbsp;-&nbsp; faliure message</i></h4><div class="highlight"><pre><span class="nv">FAIL</span> <span class="s">&quot;add-5 should increment any list of numbers by 5&quot;</span>
<span class="s">&quot;Expected: 15</span>
<span class="s"> Actual: clojure.lang.ArityException - Wrong number of args (4) passed to: fami.operations$add-5&quot;</span>
</pre></div>
</div><div><a name="add-5-v2-tests"></a><h4><i>e.5.6  &nbsp;-&nbsp; src/fami/test-operations.clj</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">fami.test-operations</span>
 <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">fami.operations</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
           <span class="p">[</span><span class="nv">midje.sweet</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>

 <span class="p">(</span><span class="nf">fact</span> <span class="s">&quot;add-5 should increment only one input by 5&quot;</span>
 <span class="p">(</span><span class="nf">add-5</span> <span class="mi">5</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">10</span>
 <span class="p">(</span><span class="nf">add-5</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="p">(</span><span class="nf">throws</span> <span class="nv">clojure.lang.ArityException</span><span class="p">))</span>
 
 <span class="p">(</span><span class="nf">fact</span> <span class="s">&quot;add-5-multi should increment any list of numbers by 5&quot;</span>
 <span class="p">(</span><span class="nf">add-5-multi</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div><div><a name="the-bug-surfaces"></a><h3>5.3 &nbsp;&nbsp; The Bug Surfaces</h3></div><div><p>Although the tests are correct, the documentation is not. Anyone using this library can potentially have the <code>clojure.lang.ArityException</code> bug if they carefully followed instructions in the documentation. </p><p>This is a trival example of a much greater problem. When a project begins to evolve and codebase begins to change, the documentation then becomes incorrect. Although source and test code can be isolated through testing, fixing documentation is a miserable and futile exercise of cut and paste. With no real tool to check whether code is still valid, the documentation become less and less correct until all the examples have to be rechecked and the documention rewritten.</p><p><strong>Then the codebase changes again ...</strong></p><p>Once the library has been release to the world and people have already started using it, there is no taking it back. Bugs propagate through miscommunication. Miscommunication with machines can usually be contained and fixed. Miscommunication with people becomes potentially more difficult to contain.</p></div><div><a name="end-notes"></a><h2><b>6 &nbsp;&nbsp; End Notes</b></h2></div><div><p>For any feedback, requests and comments, please feel free to lodge an issue on github or contact me directly.</p><p>Chris.</p></div></section></body><script type="text/javascript">var metas = document.getElementsByTagName('meta');
var i;
if (navigator.userAgent.match(/iPhone/i)) {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
    }
  }
  document.addEventListener("gesturestart", gestureStart, false);
}
function gestureStart() {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
    }
  }
}</script><script>var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-31320512-2']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();</script></html>